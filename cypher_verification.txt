
// 1. Find Evidence that covers both ISO 27001 AND Cyber Essentials
// This query looks for evidence that has tags connected to BOTH frameworks.
// This confirms your "Cross-Walk" is working.

MATCH (u:User)-[:UPLOADED]->(e:Evidence)
MATCH (e)-[:HAS_TAG]->(t:Tag)

// Check link to ISO
MATCH (t)<-[:HAS_TAG]-(c1:Control)-[:BELONGS_TO]->(s1:Standard {name: 'ISO 27001'})

// Check link to Cyber Essentials
MATCH (t)<-[:HAS_TAG]-(c2:Control)-[:BELONGS_TO]->(s2:Standard {name: 'Cyber Essentails '})

RETURN 
    e.fileName as Evidence, 
    t.name as Tag, 
    c1.code as ISO_Control, 
    c2.code as Cyber_Essentials_Control
LIMIT 20;

// 2. See all Tags for Cyber Essentials
// Run this to see exactly what tags you need to match to get coverage.
MATCH (s:Standard {name: 'Cyber Essentails '})
MATCH (s)<-[:BELONGS_TO]-(c:Control)-[:HAS_TAG]->(t:Tag)
RETURN DISTINCT t.name as Required_Tags
ORDER BY t.name;

// 3. See your current Evidence Tags vs Required Tags
MATCH (u:User {email: 'customer@example.com'})-[:UPLOADED]->(e:Evidence)-[:HAS_TAG]->(myTag:Tag)
OPTIONAL MATCH (myTag)<-[:HAS_TAG]-(c:Control)-[:BELONGS_TO]->(s:Standard {name: 'Cyber Essentails '})
RETURN 
    e.fileName, 
    myTag.name as My_Tag, 
    CASE WHEN s.name IS NOT NULL THEN 'MATCH' ELSE 'NO MATCH' END as Status
ORDER BY Status DESC;
